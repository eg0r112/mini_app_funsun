<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Результаты поиска | FUN&SUN</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Roboto, sans-serif;
    }

    body {
      background-color: #0d0d0d;
      color: #fff;
      display: flex;
      flex-direction: row;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Панель настроек */
    .settings {
      position: fixed;
      background-color: #1b1b1b;
      width: 250px;
      padding: 1.5rem;
      border-right: 1px solid #333;
      transition: transform 0.3s ease;
      z-index: 200;
    }
    .settingss {
      background-color: #1b1b1b;
      width: 250px;
      padding: 1.5rem;
      border-right: 1px solid #333;
      transition: transform 0.3s ease;
      z-index: 200;
    }

    .settings h2 {
      color: #ffcc00;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .settings ul {
      list-style: none;
    }

    .settings li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #333;
      cursor: pointer;
      transition: color 0.3s;
    }

    .settings li:hover {
      color: #ffcc00;
    }

    /* Контент */
    .content {
      flex: 1;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* Верхняя панель (только для телефона) */
    .top-bar {
      display: none;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .toggle-settings {
      background-color: #ffcc00;
      color: #000;
      border: none;
      padding: 0.8rem 1.2rem;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
      z-index: 210;
    }

    .toggle-settings:hover {
      background-color: #ffdb4d;
    }

    .logo {
      color: #ffcc00;
      font-weight: bold;
      font-size: 1.2rem;
      letter-spacing: 1px;
    }

    /* Строка поиска */
    .search-bar {
      display: flex;
      background-color: #1b1b1b;
      border-radius: 50px;
      overflow: hidden;
      width: 100%;
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
    }

    .search-bar input {
      flex: 1;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      border: none;
      outline: none;
      color: #fff;
      background: transparent;
    }

    .search-bar button {
      background-color: #ffcc00;
      color: #000;
      border: none;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .search-bar button:hover {
      background-color: #ffdb4d;
    }

    /* Результаты */
    .results {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .card {
      display: flex;
      background-color: #1b1b1b;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(255, 204, 0, 0.1);
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.02);
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
    }

    .card img {
      width: 150px;
      object-fit: cover;
    }

    .card-content {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      flex: 1;
    }

    .card-content h3 {
      color: #ffcc00;
      font-size: 1.1rem;
    }

    .stars {
      color: #ffcc00;
      font-size: 0.9rem;
    }

    .location {
      color: #ccc;
      font-size: 0.95rem;
    }

    .amenities {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      font-size: 0.85rem;
      color: #aaa;
    }

    .amenities span {
      background-color: #333;
      padding: 2px 6px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .price {
      font-weight: bold;
      color: #ffcc00;
    }

    .discount {
      color: #ff6666;
      font-size: 0.85rem;
      margin-left: 0.5rem;
    }

    .dates {
      font-size: 0.85rem;
      color: #ccc;
    }

    /* Затемнение при открытии меню */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 150;
    }

    .overlay.visible {
      display: block;
    }
    .price-range {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      color: #fff;
      font-size: 0.9rem;
    }

    .price-values {
      display: flex;
      justify-content: space-between;
      color: #ffcc00;
      font-weight: bold;
    }

    input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  background-color: #1b1b1b;
  border: 2px solid #555;
  border-radius: 50%; /* делаем его круглым */
  width: 18px;
  height: 18px;
  top: 3px;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
}

/* Наведение */
input[type="checkbox"]:hover {
  border-color: #ffcc00;
}

/* Активное состояние (нажатие) */
input[type="checkbox"]:active {
  transform: scale(0.9);
}

/* Когда чекбокс выбран */
input[type="checkbox"]:checked {
  background-color: #ffcc00;
  border-color: #ffcc00;
}

/* Галочка */
input[type="checkbox"]:checked::after {
  content: "";
  position: absolute;
  top: 3px;
  left: 3px;
  width: 8px;
  height: 8px;
  background: #000;
  border-radius: 50%; /* чтобы галочка была круглая (точка) */
}

    .price-range {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  color: #fff;
  font-size: 0.9rem;
}

.price-values {
  display: flex;
  justify-content: space-between;
  color: #ffcc00;
  font-weight: bold;
}

/* Контейнер с треком и двумя ползунками */
.range-container {
  position: relative;
  width: 100%;
  height: 30px;
}

/* Общие стили для ползунков */
.range-container input[type="range"] {
  position: absolute;
  top: 0px;
  left: 0;
  width: 100%;
  height: 6px;
  -webkit-appearance: none;
  background: none;
  pointer-events: none; /* чтобы они не мешали друг другу */
}

/* Чтобы активный ползунок был поверх другого */
.range-container input[type="range"].active {
  z-index: 3;
  pointer-events: all;
}

/* Трек */
.range-container input[type="range"]::-webkit-slider-runnable-track {
  height: 6px;
  background: #333;
  border-radius: 5px;
}
.range-container input[type="range"]::-moz-range-track {
  height: 6px;
  background: #333;
  border-radius: 5px;
}

/* Ручка */
.range-container input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  height: 16px;
  width: 16px;
  border-radius: 50%;
  background: #ffcc00;
  cursor: pointer;
  pointer-events: all;
  position: relative;
  bottom: 5px;
  z-index: 4;
}
.range-container input[type="range"]::-moz-range-thumb {
  height: 16px;
  width: 16px;
  border-radius: 50%;
  background: #ffcc00;
  cursor: pointer;
  position: relative;
  z-index: 4;
}

/* Активный диапазон (жёлтая полоса между ручками) */
.range-track {
  position: absolute;
  height: 6px;
  top: 50%;
  transform: translateY(-50%);
  background: #ffcc00;
  border-radius: 5px;
  z-index: 1;
}


.range-sliders input[type="range"]:focus::-webkit-slider-runnable-track {
  background: #555;
}

.star-rating {
  display: flex;
  gap: 5px;
  font-size: 1.4rem;
  color: #555; /* неактивные звёзды */
  cursor: pointer;
  transition: color 0.3s ease;
  user-select: none;
}

.star-rating span {
  transition: transform 0.2s, color 0.2s;
}

.star-rating span:hover {
  transform: scale(1.2);
}

/* Активные звёзды (выбранные) */
.star-rating .active {
  color: #ffcc00;
}
.counter {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 5px;
}

.counter button {
  width: 30px;
  height: 30px;
  background-color: #ffcc00;
  color: #000;
  border: none;
  border-radius: 50%;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.3s;
}

.counter button:hover {
  background-color: #ffdb4d;
}

.counter input {
  width: 50px;
  text-align: center;
  border: 1px solid #555;
  border-radius: 5px;
  background-color: #1b1b1b;
  color: #fff;
  font-size: 1rem;
  padding: 4px;
}
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}
.counter button {
  width: 14px;
  height: 14px;
  font-size: 16px;
  padding: 0;
  border-radius: 50%;
  background-color: #ffcc00;
  color: #000;
  border: none;
  cursor: pointer;
  line-height: 14px;
  text-align: center;
}

/* поднимаем только символ внутри кнопки */
.counter button::before {
  content: attr(data-symbol);
  display: inline-block;
  transform: translateY(-2px); /* смещаем текст вверх */
}
/* Firefox */
input[type=number] {
    -moz-appearance: textfield;
}
.sort-options {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.custom-radio {
  display: flex;
  align-items: center;
  cursor: pointer;
  color: #fff;
  font-size: 0.95rem;
  position: relative;
  user-select: none;
}

.custom-radio input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.custom-radio span {
  width: 18px;
  height: 18px;
  border: 2px solid #555;
  border-radius: 50%;
  margin-right: 10px;
  display: inline-block;
  position: relative;
  transition: all 0.3s;
}

/* активное состояние (когда выбрано) */
.custom-radio input:checked + span {
  border-color: #ffcc00;
  background-color: #ffcc00;
}

/* внутренний кружок */
.custom-radio span::after {
  content: "";
  position: absolute;
  display: none;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  background: #000;
  border-radius: 50%;
  transform: translate(-50%, -50%);
}

.custom-radio input:checked + span::after {
  display: block;
}
#applySortBtn {
  margin-top: 10px;
  width: 100%;
  text-align: center;
}
.apply-btn {
  margin-top: 10px;
  margin-bottom: 20px;
  width: 100%;
  height: 40px;
  padding: 0;
  border-radius: 25px;          /* плавные края */
  background-color: #ffcc00;    /* основной жёлтый цвет */
  color: #000;                  /* текст чёрный */
  font-weight: bold;
  font-size: 1rem;
  text-align: center;
  cursor: pointer;
  border: none;
  transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 3px 6px rgba(255, 204, 0, 0.4);
}

.apply-btn:hover {
  background-color: #ffdb4d;     /* светлее при наведении */
  transform: translateY(-1px);   /* лёгкий эффект поднятия */
  box-shadow: 0 5px 10px rgba(255, 204, 0, 0.5);
}

.apply-btn:active {
  transform: translateY(0);      /* при нажатии кнопка опускается */
  box-shadow: 0 2px 4px rgba(255, 204, 0, 0.3);
}
#applySortBtn {
  margin-top: 10px;
  margin-bottom: 20px;
  width: 100%;
  height: 40px;
  padding: 0;
  border-radius: 25px;          /* плавные края */
  background-color: #ffcc00;    /* основной жёлтый цвет */
  color: #000;                  /* текст чёрный */
  font-weight: bold;
  font-size: 1rem;
  text-align: center;
  cursor: pointer;
  border: none;
  transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 3px 6px rgba(255, 204, 0, 0.4);
}

#applySortBtn:hover {
  background-color: #ffdb4d;     /* светлее при наведении */
  transform: translateY(-1px);   /* лёгкий эффект поднятия */
  box-shadow: 0 5px 10px rgba(255, 204, 0, 0.5);
}

#applySortBtn:active {
  transform: translateY(0);      /* при нажатии кнопка опускается */
  box-shadow: 0 2px 4px rgba(255, 204, 0, 0.3);
}
    /* Мобильная адаптация */
    @media (max-width: 768px) {
      .settingss{
        display: none;
      }
      body {
        flex-direction: column;
      }

      .settings {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        transform: translateX(-100%);
        border-right: none;
        border-bottom: 1px solid #333;
      }

      .settings.visible {
        transform: translateX(0);
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.6);
      }

      .top-bar {
        display: flex;
      }

      .search-bar {
        flex-direction: column;
        border-radius: 15px;
      }

      .search-bar input,
      .search-bar button {
        width: 100%;
        border-radius: 0;
      }

      .search-bar button {
        border-top: 1px solid #333;
      }

      .card {
        flex-direction: column;
      }

      .card img {
        width: 100%;
        height: 180px;
      }
    }
  </style>
</head>
<body>
  <aside class="settingss" id="settingsPanell"></aside>
  <!-- Панель настроек -->
  <aside class="settings" id="settingsPanel">
    <h2>Фильтры</h2>
    <ul>
      <li>
        <label for="priceRange">Диапазон цены</label>
      </li>
      <li>
        <div class="price-range">
          <div class="price-values">
            <span id="priceMinDisplay">0 ₽</span> —
            <span id="priceMaxDisplay">100000 ₽</span>
          </div>
          <div class="range-container">
            <div class="range-track" id="priceTrack"></div>
            <input type="range" id="priceMin" min="0" max="100000" value="0" step="500">
            <input type="range" id="priceMax" min="0" max="300000" value="300000" step="500">
          </div>
        </div>
      </li>
      <li>
        <label for="starRating">Рейтинг</label>
        <div class="star-rating" id="starRating">
          <span data-value="1">★</span>
          <span data-value="2">★</span>
          <span data-value="3">★</span>
          <span data-value="4">★</span>
          <span data-value="5">★</span>
        </div>
      </li>
      <li>
        <label>Взрослые</label>
        <div class="counter">
          <button class="minus" data-symbol="-"></button>
          <input type="number" min="1" max="10" value="2" class="counter-input">
          <button class="plus" data-symbol="+"></button>
        </div>
      </li>
      
      <li>
        <label>Дети</label>
        <div class="counter">
          <button class="minus" data-symbol="-"></button>
          <input type="number" min="0" max="10" value="0" class="counter-input">
          <button class="plus" data-symbol="+"></button>
        </div>
      </li>
      <li>
        <label>
          <input type="checkbox" id="directFlights">
          Кровати для детей
        </label>
      </li>
      <li>
        <label>
          <input type="checkbox" id="Test1">
          Чекбокс для красоты
        </label>
      </li>
      <li>
        <label>
          <input type="checkbox" id="Test">
          Чекбокс для красоты
        </label>
      </li>
    </ul>

    <button class="apply-btn" id="applySettings">Применить</button>
    <h2>Сортировка</h2>
    <ul class="sort-options">
      <li>
        <label class="custom-radio">
          <input type="radio" name="sort" value="priceAsc">
          <span></span>
          по возрастанию цены
        </label>
      </li>
      <li>
        <label class="custom-radio">
          <input type="radio" name="sort" value="priceDesc">
          <span></span>
          по убыванию цены
        </label>
      </li>
      <li>
        <label class="custom-radio">
          <input type="radio" name="sort" value="starAsc">
          <span></span>
          по возрастанию звёзд
        </label>
      </li>
      <li>
        <label class="custom-radio">
          <input type="radio" name="sort" value="starDesc">
          <span></span>
          по убыванию звёзд
        </label>
      </li>
    </ul>
    <button id="applySortBtn" class="toggle-settings">Применить</button>
  </aside>

  <!-- Затемнение -->
  <div class="overlay" id="overlay"></div>

  <!-- Контент -->
  <main class="content">
    <div class="top-bar">
      <button class="toggle-settings" id="toggleBtn">Настройки</button>
      <div class="logo">FUN&SUN</div>
    </div>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Изменить направление" />
      <button id="searchBtn">Найти</button>
    </div>

    <div id="resultsContainer" class="results">
      <!-- <div class="card">
        <img src="https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL" alt="Отель 1">
        <div class="card-content">
          <h3>Отель Paradise</h3>
          <div class="stars">★★★★☆</div>
          <div class="location">Паттайя, Таиланд</div>
          <div class="amenities">
            <span>📶 Wi-Fi</span>
            <span>❄️ Кондиционер</span>
            <span>🏊 Бассейн</span>
          </div>
          <div>
            <span class="price">7 200 ₽</span>
            <span class="discount">10% скидка</span>
          </div>
          <div class="dates">12–19 октября | 7 ночей</div>
        </div>
      </div>

      <div class="card">
        <img src="https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL" alt="Отель 2">
        <div class="card-content">
          <h3>Отель Sunny Beach</h3>
          <div class="stars">★★★☆☆</div>
          <div class="location">Хургада, Египет</div>
          <div class="amenities">
            <span>📶 Wi-Fi</span>
            <span>🍳 Завтрак</span>
            <span>🏊 Бассейн</span>
          </div>
          <div>
            <span class="price">5 800 ₽</span>
            <span class="discount">5% скидка</span>
          </div>
          <div class="dates">15–22 октября | 7 ночей</div>
        </div>
      </div>

      <div class="card">
        <img src="https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL" alt="Отель 3">
        <div class="card-content">
          <h3>Отель Ocean View</h3>
          <div class="stars">★★★★★</div>
          <div class="location">Бали, Индонезия</div>
          <div class="amenities">
            <span>📶 Wi-Fi</span>
            <span>❄️ Кондиционер</span>
            <span>💆 SPA</span>
          </div>
          <div>
            <span class="price">12 500 ₽</span>
            <span class="discount">15% скидка</span>
          </div>
          <div class="dates">20–27 октября | 7 ночей</div>
        </div>
      </div> -->
    </div>
  </main>

  <script>
    document.getElementById('applySettings').addEventListener('click', () => {
      const sortValue = document.querySelector('input[name="sort"]:checked').value;
      const direct = document.getElementById('directFlights').checked;
      const transfers = document.getElementById('withTransfers').checked;
      const airline = document.getElementById('airlineFilter').value;

      const settings = {
        sortBy: sortValue,
        directFlights: direct,
        withTransfers: transfers,
        airlineFilter: airline,
      };

      console.log('Настройки применены:', settings);

      alert(
        `✅ Настройки применены:\n\n` +
        `Сортировка: ${sortValue === 'price' ? 'по цене' : 'по дате'}\n` +
        `Прямые рейсы: ${direct ? 'да' : 'нет'}\n` +
        `С пересадками: ${transfers ? 'да' : 'нет'}\n` +
        `Авиакомпания: ${airline}`
      );
    });
    const priceMin = document.getElementById('priceMin');
    const priceMax = document.getElementById('priceMax');
    const priceMinDisplay = document.getElementById('priceMinDisplay');
    const priceMaxDisplay = document.getElementById('priceMaxDisplay');
    const minGap = 1000; // минимальная разница между значениями

    function updatePriceDisplays() {
      let minVal = parseInt(priceMin.value);
      let maxVal = parseInt(priceMax.value);

      if (maxVal - minVal < minGap) {
        if (event.target === priceMin) {
          priceMin.value = maxVal - minGap;
          minVal = priceMin.value;
        } else {
          priceMax.value = parseInt(priceMin.value) + minGap;
          maxVal = priceMax.value;
        }
      }

      priceMinDisplay.textContent = `${Number(minVal).toLocaleString('ru-RU')} ₽`;
      priceMaxDisplay.textContent = `${Number(maxVal).toLocaleString('ru-RU')} ₽`;
    }

    priceMin.addEventListener('input', updatePriceDisplays);
    priceMax.addEventListener('input', updatePriceDisplays);
    updatePriceDisplays();
    const stars = document.querySelectorAll('#starRating span');
    let selectedRating = 0;

    stars.forEach(star => {
      star.addEventListener('click', () => {
        selectedRating = parseInt(star.getAttribute('data-value'));
        updateStars();
      });

      star.addEventListener('mouseover', () => {
        const hoverValue = parseInt(star.getAttribute('data-value'));
        highlightStars(hoverValue);
      });

      star.addEventListener('mouseleave', () => {
        updateStars();
      });
    });

    function updateStars() {
      stars.forEach(star => {
        star.classList.toggle('active', parseInt(star.getAttribute('data-value')) <= selectedRating);
      });
    }

    function highlightStars(value) {
      stars.forEach(star => {
        star.classList.toggle('active', parseInt(star.getAttribute('data-value')) <= value);
      });
    }
    document.querySelectorAll(".counter").forEach(counter => {
      const input = counter.querySelector(".counter-input");
      const btnMinus = counter.querySelector(".minus");
      const btnPlus = counter.querySelector(".plus");
      const min = parseInt(input.min);
      const max = parseInt(input.max);

      btnMinus.addEventListener("click", () => {
        let value = parseInt(input.value) || min;
        if (value > min) {
          input.value = value - 1;
        }
      });

      btnPlus.addEventListener("click", () => {
        let value = parseInt(input.value) || min;
        if (value < max) {
          input.value = value + 1;
        }
      });

      // Ввод вручную
      input.addEventListener("input", () => {
        let value = parseInt(input.value);
        if (isNaN(value)) return; // разрешаем полностью стереть поле
        if (value < min) value = min;
        if (value > max) value = max;
        input.value = value;
      });

  // Событие при уходе из поля (blur)
  input.addEventListener("blur", () => {
    if (input.value === "" || isNaN(parseInt(input.value))) {
      input.value = min; // ставим минимальное значение
    }
  });
});
    // Переход при новом поиске
    // document.getElementById('searchBtn').addEventListener('click', () => {
    //   const query = document.getElementById('searchInput').value.trim();
    //   if (query) {
    //     window.location.href = `results.html?query=${encodeURIComponent(query)}`;
    //   } else {
    //     alert('Введите направление для поиска');
    //   }
    // });

    // Подстановка запроса из первой страницы
    const params = new URLSearchParams(window.location.search);
    const query = params.get('query');
    if (query) {
      document.getElementById('searchInput').value = query;
    }

    // Переключение панели на телефоне
    const toggleBtn = document.getElementById('toggleBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const overlay = document.getElementById('overlay');

    toggleBtn.addEventListener('click', () => {
      const isVisible = settingsPanel.classList.toggle('visible');
      overlay.classList.toggle('visible', isVisible);
      toggleBtn.style.display = isVisible ? 'none' : 'inline-block';
    });

    overlay.addEventListener('click', () => {
      settingsPanel.classList.remove('visible');
      overlay.classList.remove('visible');
      toggleBtn.style.display = 'inline-block';
    });
    const input = document.getElementById('searchInput');
        const button = document.getElementById('searchBtn');

        const aiData = JSON.parse(sessionStorage.getItem("aiResponse") || "{}");
        console.log("???????????????????????????????????????????????????????????\n",JSON.stringify(aiData));


        // Проверяем наличие туров
        if (aiData.tour_json) {
        let tours;
        try {
          tours = JSON.parse(aiData.tour_json);
        } catch (err) {
          console.error("Ошибка парсинга tour_json:", err);
          tours = [];
        }

        if (
          tours &&
          typeof tours === "object" &&
          !Array.isArray(tours) &&
          "message" in tours &&
          tours.message == "Туры не найдены по указанным параметрам"
        ) {
          console.log(tours.message);
        } else {
          const resultsContainer = document.getElementById("resultsContainer");
          let allTours = [...tours]; // сохраняем оригинальные туры

          // Функция генерации звёзд
          function generateStars(count) {
            const fullStars = "★".repeat(count);
            const emptyStars = "☆".repeat(5 - count);
            return fullStars + emptyStars;
          }

          // Функция отрисовки карточек
          function renderTours(tourList) {
            resultsContainer.innerHTML = "";
            tourList.forEach((tour, index) => {
              const card = document.createElement("div");
              card.className = "card";
              card.style.cursor = "pointer";

              card.addEventListener("click", () => {
                window.location.href =
                  "https://fstravel.com/hotel/europe/turkey/side/cholakli/funsun-smart-hane-sun?withFly=true";
              });

              const img = document.createElement("img");
              img.src =
                "https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL";
              img.alt = tour.NameHotel || `Отель ${index + 1}`;

              const content = document.createElement("div");
              content.className = "card-content";

              const h3 = document.createElement("h3");
              h3.textContent = tour.NameHotel || "Отель";

              const stars = document.createElement("div");
              stars.className = "stars";
              stars.textContent = generateStars(tour.Star || 0);

              const location = document.createElement("div");
              location.className = "location";
              location.textContent = `${tour.CityOut || ""}, ${tour.Country || ""}`;

              const amenities = document.createElement("div");
              amenities.className = "amenities";
              amenities.innerHTML =
                "<span>📶 Wi-Fi</span><span>🍳 Завтрак</span><span>🏊 Бассейн</span>";

              const priceDiv = document.createElement("div");
              const price = document.createElement("span");
              price.className = "price";
              price.textContent = `${tour.Price?.toLocaleString("ru-RU") || "-"} ₽`;
              priceDiv.appendChild(price);

              const dates = document.createElement("div");
              dates.className = "dates";
              dates.textContent = `${tour.StartEnd?.replace("-", " | ")} | ${
                tour.Duration || "-"
              } ночей`;

              content.append(h3, stars, location, amenities, priceDiv, dates);
              card.append(img, content);
              resultsContainer.appendChild(card);
            });
          }

          // Первичный рендер
          renderTours(allTours);

          // Сортировка по кнопке "Применить"
          const applySortBtn = document.getElementById("applySortBtn");

          applySortBtn.addEventListener("click", () => {
            const selectedRadio = document.querySelector('input[name="sort"]:checked');

            if (!selectedRadio) {
              alert("Выберите вариант сортировки!");
              return;
            }

            const value = selectedRadio.value;
            let sortedTours = [...allTours];

            switch (value) {
              case "priceAsc":
                sortedTours.sort((a, b) => (a.Price || 0) - (b.Price || 0));
                break;
              case "priceDesc":
                sortedTours.sort((a, b) => (b.Price || 0) - (a.Price || 0));
                break;
              case "starAsc":
                sortedTours.sort((a, b) => (a.Star || 0) - (b.Star || 0));
                break;
              case "starDesc":
                sortedTours.sort((a, b) => (b.Star || 0) - (a.Star || 0));
                break;
            }

            renderTours(sortedTours);
          });
        }
      }

        // Обрабатываем клик по кнопке
        button.addEventListener('click', () => {
        const query = input.value.trim();

        if (!query) {
                return;
            }
          button.textContent = "Поиск 🔍...";
          button.disabled = true; // отключаем кнопку, пока идёт запрос

          const aiReq = {
            request: query,   // строка запроса
            response: "string"      // сервер заполнит
        };

        fetch("http://localhost:5171/api/AI_req_Сontroller/request", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(aiReq)
        })
        .then(async res => {
            const text = await res.text(); // читаем как текст
            // console.log("Raw response:", text);

            let data;
            try {
                data = JSON.parse(text); // парсим JSON
            } catch (err) {
                console.error("Ошибка парсинга JSON:", err);
                alert("Сервер вернул невалидный JSON. Смотрите консоль.");
                return;
            }
            sessionStorage.setItem("aiResponse", JSON.stringify(data));
            if (data.Response) console.log("AI Response:", data.Response);
            if (data.success) window.location.href = `results.html?query=${encodeURIComponent(query)}`;
            else alert("Ошибка от сервера: " + (data.message || "Неизвестная ошибка"));
            // console.log("Parsed JSON:", data);
        })
        .catch(err => console.error("Ошибка fetch:", err));
        });
  </script>
</body>
</html>

