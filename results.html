<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ | FUN&SUN</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Roboto, sans-serif;
    }

    body {
      background-color: #0d0d0d;
      color: #fff;
      display: flex;
      flex-direction: row;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
    .settings {
      background-color: #1b1b1b;
      width: 250px;
      padding: 1.5rem;
      border-right: 1px solid #333;
      transition: transform 0.3s ease;
      z-index: 200;
    }

    .settings h2 {
      color: #ffcc00;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .settings ul {
      list-style: none;
    }

    .settings li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #333;
      cursor: pointer;
      transition: color 0.3s;
    }

    .settings li:hover {
      color: #ffcc00;
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç */
    .content {
      flex: 1;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞) */
    .top-bar {
      display: none;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .toggle-settings {
      background-color: #ffcc00;
      color: #000;
      border: none;
      padding: 0.8rem 1.2rem;
      border-radius: 25px;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
      z-index: 210;
    }

    .toggle-settings:hover {
      background-color: #ffdb4d;
    }

    .logo {
      color: #ffcc00;
      font-weight: bold;
      font-size: 1.2rem;
      letter-spacing: 1px;
    }

    /* –°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ */
    .search-bar {
      display: flex;
      background-color: #1b1b1b;
      border-radius: 50px;
      overflow: hidden;
      width: 100%;
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
    }

    .search-bar input {
      flex: 1;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      border: none;
      outline: none;
      color: #fff;
      background: transparent;
    }

    .search-bar button {
      background-color: #ffcc00;
      color: #000;
      border: none;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .search-bar button:hover {
      background-color: #ffdb4d;
    }

    /* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã */
    .results {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .card {
      display: flex;
      background-color: #1b1b1b;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(255, 204, 0, 0.1);
      transition: transform 0.2s;
    }

    .card:hover {
      transform: scale(1.02);
      box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
    }

    .card img {
      width: 150px;
      object-fit: cover;
    }

    .card-content {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      flex: 1;
    }

    .card-content h3 {
      color: #ffcc00;
      font-size: 1.1rem;
    }

    .stars {
      color: #ffcc00;
      font-size: 0.9rem;
    }

    .location {
      color: #ccc;
      font-size: 0.95rem;
    }

    .amenities {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      font-size: 0.85rem;
      color: #aaa;
    }

    .amenities span {
      background-color: #333;
      padding: 2px 6px;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .price {
      font-weight: bold;
      color: #ffcc00;
    }

    .discount {
      color: #ff6666;
      font-size: 0.85rem;
      margin-left: 0.5rem;
    }

    .dates {
      font-size: 0.85rem;
      color: #ccc;
    }

    /* –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–µ–Ω—é */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 150;
    }

    .overlay.visible {
      display: block;
    }

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }

      .settings {
        position: fixed;
        top: 0;
        left: 0;
        height: 100%;
        transform: translateX(-100%);
        border-right: none;
        border-bottom: 1px solid #333;
      }

      .settings.visible {
        transform: translateX(0);
        box-shadow: 5px 0 15px rgba(0, 0, 0, 0.6);
      }

      .top-bar {
        display: flex;
      }

      .search-bar {
        flex-direction: column;
        border-radius: 15px;
      }

      .search-bar input,
      .search-bar button {
        width: 100%;
        border-radius: 0;
      }

      .search-bar button {
        border-top: 1px solid #333;
      }

      .card {
        flex-direction: column;
      }

      .card img {
        width: 100%;
        height: 180px;
      }
    }
  </style>
</head>
<body>
  <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <aside class="settings" id="settingsPanel">
    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    <ul>
      <li>–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ü–µ–Ω–µ</li>
      <li>–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ</li>
      <li>–ü—Ä—è–º—ã–µ —Ä–µ–π—Å—ã</li>
      <li>–° –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏</li>
      <li>–§–∏–ª—å—Ç—Ä –∞–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏–π</li>
    </ul>
  </aside>

  <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ -->
  <div class="overlay" id="overlay"></div>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="content">
    <div class="top-bar">
      <button class="toggle-settings" id="toggleBtn">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <div class="logo">FUN&SUN</div>
    </div>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" />
      <button id="searchBtn">–ù–∞–π—Ç–∏</button>
    </div>

    <div id="resultsContainer" class="results">
      <!-- <div class="card">
        <img src="https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL" alt="–û—Ç–µ–ª—å 1">
        <div class="card-content">
          <h3>–û—Ç–µ–ª—å Paradise</h3>
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
          <div class="location">–ü–∞—Ç—Ç–∞–π—è, –¢–∞–∏–ª–∞–Ω–¥</div>
          <div class="amenities">
            <span>üì∂ Wi-Fi</span>
            <span>‚ùÑÔ∏è –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä</span>
            <span>üèä –ë–∞—Å—Å–µ–π–Ω</span>
          </div>
          <div>
            <span class="price">7 200 ‚ÇΩ</span>
            <span class="discount">10% —Å–∫–∏–¥–∫–∞</span>
          </div>
          <div class="dates">12‚Äì19 –æ–∫—Ç—è–±—Ä—è | 7 –Ω–æ—á–µ–π</div>
        </div>
      </div>

      <div class="card">
        <img src="https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL" alt="–û—Ç–µ–ª—å 2">
        <div class="card-content">
          <h3>–û—Ç–µ–ª—å Sunny Beach</h3>
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</div>
          <div class="location">–•—É—Ä–≥–∞–¥–∞, –ï–≥–∏–ø–µ—Ç</div>
          <div class="amenities">
            <span>üì∂ Wi-Fi</span>
            <span>üç≥ –ó–∞–≤—Ç—Ä–∞–∫</span>
            <span>üèä –ë–∞—Å—Å–µ–π–Ω</span>
          </div>
          <div>
            <span class="price">5 800 ‚ÇΩ</span>
            <span class="discount">5% —Å–∫–∏–¥–∫–∞</span>
          </div>
          <div class="dates">15‚Äì22 –æ–∫—Ç—è–±—Ä—è | 7 –Ω–æ—á–µ–π</div>
        </div>
      </div>

      <div class="card">
        <img src="https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL" alt="–û—Ç–µ–ª—å 3">
        <div class="card-content">
          <h3>–û—Ç–µ–ª—å Ocean View</h3>
          <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <div class="location">–ë–∞–ª–∏, –ò–Ω–¥–æ–Ω–µ–∑–∏—è</div>
          <div class="amenities">
            <span>üì∂ Wi-Fi</span>
            <span>‚ùÑÔ∏è –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä</span>
            <span>üíÜ SPA</span>
          </div>
          <div>
            <span class="price">12 500 ‚ÇΩ</span>
            <span class="discount">15% —Å–∫–∏–¥–∫–∞</span>
          </div>
          <div class="dates">20‚Äì27 –æ–∫—Ç—è–±—Ä—è | 7 –Ω–æ—á–µ–π</div>
        </div>
      </div> -->
    </div>
  </main>

  <script>
    // –ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–∏—Å–∫–µ
    // document.getElementById('searchBtn').addEventListener('click', () => {
    //   const query = document.getElementById('searchInput').value.trim();
    //   if (query) {
    //     window.location.href = `results.html?query=${encodeURIComponent(query)}`;
    //   } else {
    //     alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞');
    //   }
    // });

    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const params = new URLSearchParams(window.location.search);
    const query = params.get('query');
    if (query) {
      document.getElementById('searchInput').value = query;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
    const toggleBtn = document.getElementById('toggleBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const overlay = document.getElementById('overlay');

    toggleBtn.addEventListener('click', () => {
      const isVisible = settingsPanel.classList.toggle('visible');
      overlay.classList.toggle('visible', isVisible);
      toggleBtn.style.display = isVisible ? 'none' : 'inline-block';
    });

    overlay.addEventListener('click', () => {
      settingsPanel.classList.remove('visible');
      overlay.classList.remove('visible');
      toggleBtn.style.display = 'inline-block';
    });
    const input = document.getElementById('searchInput');
        const button = document.getElementById('searchBtn');

        const aiData = JSON.parse(sessionStorage.getItem("aiResponse") || "{}");
        console.log("???????????????????????????????????????????????????????????\n",JSON.stringify(aiData));


        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç—É—Ä–æ–≤
        if (aiData.tour_json) {
          let tours;
          try {
            tours = JSON.parse(aiData.tour_json); // –º–∞—Å—Å–∏–≤ —Ç—É—Ä–æ–≤
          } catch (err) {
            console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ tour_json:", err);
            tours = [];
          }

          if (tours && typeof tours === "object" && !Array.isArray(tours) && "message" in tours && tours.message=="–¢—É—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º") {
            console.log(tours.message);
          }
          else
          {

            const resultsContainer = document.getElementById("resultsContainer");

            function generateStars(count) {
              const fullStars = "‚òÖ".repeat(count);
              const emptyStars = "‚òÜ".repeat(5 - count);
              return fullStars + emptyStars;
            }

            tours.forEach((tour, index) => {
              const card = document.createElement("div");
              card.className = "card";

              // –ü–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≤ —Ç–æ–º –∂–µ –æ–∫–Ω–µ
              card.addEventListener("click", () => {
                window.location.href =
                  "https://fstravel.com/hotel/europe/turkey/side/cholakli/funsun-smart-hane-sun?withFly=true&departureCityId=274286&arrivalCountryId=18803&minStartDate=2025-10-27&maxStartDate=2025-10-27&minNightsCount=7&maxNightsCount=7&adults=2&isInstantConfirmation=true&priceId=0x430A000335B50000042F6E000049730000004E00000000F7C4DFFDB3830000027CE89E07000BE11B0000A7F20000000E000004FE000000000000000000000072010B913AB38A0000070000000000AF52D00000000302020000636363B3830000B38A000002000000001E00000000000000000000000000000000000000000000000000000000&flightTypes=charter";
              });

              card.style.cursor = "pointer";

              const img = document.createElement("img");
              img.src =
                "https://cdn-ya.readytotrip.com/get-altay/10768923/2a0000018a5da39f47d06beac164769c80c6/XXL";
              img.alt = tour.NameHotel || `–û—Ç–µ–ª—å ${index + 1}`;

              const content = document.createElement("div");
              content.className = "card-content";

              const h3 = document.createElement("h3");
              h3.textContent = tour.NameHotel || "–û—Ç–µ–ª—å";

              const stars = document.createElement("div");
              stars.className = "stars";
              stars.textContent = generateStars(tour.Star || 0);

              const location = document.createElement("div");
              location.className = "location";
              location.textContent = `${tour.CityOut || ""}, ${tour.Country || ""}`;

              const amenities = document.createElement("div");
              amenities.className = "amenities";
              amenities.innerHTML =
                "<span>üì∂ Wi-Fi</span><span>üç≥ –ó–∞–≤—Ç—Ä–∞–∫</span><span>üèä –ë–∞—Å—Å–µ–π–Ω</span>";

              const priceDiv = document.createElement("div");
              const price = document.createElement("span");
              price.className = "price";
              price.textContent = `${tour.Price?.toLocaleString("ru-RU") || "-"} ‚ÇΩ`;
              priceDiv.appendChild(price);

              const dates = document.createElement("div");
              dates.className = "dates";
              dates.textContent = `${tour.StartEnd?.replace("-", " | ")} | ${
                tour.Duration || "-"
              } –Ω–æ—á–µ–π`;

              content.append(h3, stars, location, amenities, priceDiv, dates);
              card.append(img, content);
              resultsContainer.appendChild(card);
            });
          }
        }

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ
        button.addEventListener('click', () => {
        const query = input.value.trim();

        if (!query) {
                return;
            }
          button.textContent = "–ü–æ–∏—Å–∫ üîç...";
          button.disabled = true; // –æ—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É, –ø–æ–∫–∞ –∏–¥—ë—Ç –∑–∞–ø—Ä–æ—Å

          const aiReq = {
            request: query,   // —Å—Ç—Ä–æ–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
            response: "string"      // —Å–µ—Ä–≤–µ—Ä –∑–∞–ø–æ–ª–Ω–∏—Ç
        };

        fetch("http://localhost:5171/api/AI_req_–°ontroller/request", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(aiReq)
        })
        .then(async res => {
            const text = await res.text(); // —á–∏—Ç–∞–µ–º –∫–∞–∫ —Ç–µ–∫—Å—Ç
            // console.log("Raw response:", text);

            let data;
            try {
                data = JSON.parse(text); // –ø–∞—Ä—Å–∏–º JSON
            } catch (err) {
                console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:", err);
                alert("–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON. –°–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å.");
                return;
            }
            sessionStorage.setItem("aiResponse", JSON.stringify(data));
            if (data.Response) console.log("AI Response:", data.Response);
            if (data.success) window.location.href = `results.html?query=${encodeURIComponent(query)}`;
            else alert("–û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: " + (data.message || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"));
            // console.log("Parsed JSON:", data);
        })
        .catch(err => console.error("–û—à–∏–±–∫–∞ fetch:", err));
        });
  </script>
</body>
</html>

